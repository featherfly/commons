apply plugin: 'java'
// apply plugin: 'maven-publish'
// apply plugin: 'signing'
apply plugin: "com.vanniktech.maven.publish"

def isReleaseBuild() {
    return System.getProperty("snapshot") == null && System.getProperty("SNAPSHOT") == null && getProperties().get("snapshot") == null && getProperties().get("SNAPSHOT") == null 
}

def getFinalVersion() {
    return isReleaseBuild() ? version : version + "-SNAPSHOT"
}

def getSonatypeRepositoryUrl() {
    if (isReleaseBuild()) {
        println 'RELEASE BUILD'
        return hasProperty('RELEASE_REPOSITORY_URL') ? RELEASE_REPOSITORY_URL :
                "https://central.sonatype.com"
                // "https://oss.sonatype.org/service/local/staging/deploy/maven2/"
    } else {
        println 'SNAPSHOT BUILD'
        return hasProperty('SNAPSHOT_REPOSITORY_URL') ? SNAPSHOT_REPOSITORY_URL :
                "https://central.sonatype.com/content/repositories/snapshots/"
                // "https://oss.sonatype.org/content/repositories/snapshots/"
    
    }
}

def getRepositoryUsername() {
    if (hasProperty('localNexusUsername')) {
        return hasProperty('localNexusUsername') ? localNexusUsername : ""
    } else {
        return hasProperty('nexusUsername') ? nexusUsername : ""
    }
}

def getRepositoryPassword() {
    if (hasProperty('localNexusPassword')) {
        return hasProperty('localNexusPassword') ? localNexusPassword : ""
    } else {
        hasProperty('nexusPassword') ? nexusPassword : ""
    }
}

task sourcesJar(type: Jar) {
    archiveClassifier.set("sources")
    from sourceSets.main.java.srcDirs
}

task javadocJar(type: Jar, dependsOn:javadoc) {
    archiveClassifier.set("javadoc")
    from javadoc.destinationDir
}

mavenPublishing {
    publishToMavenCentral()

    signAllPublications()

    coordinates(group, archivesBaseName, getFinalVersion())

    pom {
        name = archivesBaseName
    }
}

